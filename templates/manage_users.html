{% extends "admin_base.html" %}
{% block title %}Manage Users{% endblock %}

{% block content %}
<h1>Manage Users</h1>

<div class="card" style="margin-bottom: 40px; max-width: 500px;">
    <h3 style="margin-bottom: 20px;">Add New User</h3>
    <form method="post" action="{{ url_for('add_user') }}">
        <div class="form-group">
            <label for="username">Username</label>
            <input type="text" id="username" name="username" required placeholder="Enter username">
        </div>

        <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" name="password" required placeholder="Enter password">
        </div>

        <button type="submit" class="btn btn-primary" style="width: 100%;">
            <i class="fa-solid fa-user-plus"></i> Add User
        </button>
    </form>
</div>

<h2>Existing Users</h2>
{% if users %}
<div class="table-container">
    <table>
        <thead>
            <tr>
                <th style="width: 10%; text-align: center;">ID</th>
                <th style="width: 40%;">Username</th>
                <th style="width: 30%;">Created At</th>
                <th style="width: 20%; text-align: center;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td style="text-align: center; color: var(--text-muted);">{{ user['user_id'] }}</td>
                <td style="font-weight: 600;">
                    {{ user['username'] }}
                    {% if user['role'] == 'admin' %}
                    <span
                        style="background-color: var(--primary-red); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.7em; margin-left: 8px; text-transform: uppercase;">
                        Admin
                    </span>
                    {% endif %}
                </td>
                <td class="text-muted">{{ user.get('created_at') | datetime }}</td>
                <td style="text-align: center;">
                    <div style="display: flex; justify-content: center; gap: 10px;">
                        <a href="{{ url_for('edit_user', user_id=user['username']) }}" class="btn btn-outline btn-icon"
                            title="Edit">
                            <i class="fa-solid fa-pencil"></i>
                        </a>
                        <form method="post" action="{{ url_for('delete_user', user_id=user['username']) }}"
                            onsubmit="return confirm('Delete user {{ user.username }}?');" style="margin: 0;">
                            <button type="submit" class="btn btn-outline btn-icon"
                                style="color: var(--error-color); border-color: var(--error-color);" title="Delete">
                                <i class="fa-solid fa-trash-can"></i>
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert success">No users found.</div>
{% endif %}
{% endblock %}